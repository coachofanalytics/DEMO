{%extends "main/base_templates/new_base.html"%} 
{% load static %}
{% block content %}
<div class="banner-div">
  {% if asset_image_url %}
  <img class="banner-div" style="position: absolute; width: 100%; height: 100%;" src="{{ asset_image_url }}" alt="Service Image">
{% else %}
  <img class="banner-div" style="position: absolute; width: 100%; height: 100%;" src="{% static 'main/image/default_image.jpg' %}" alt="Default Image">
{% endif %}
  <div class="container-md" >
      <h2 id="truncatedTitle">{{title }}</h2>
    <h1 style="font-size: 64px;">{{sub_titles}}</h1>
  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function() {
      var titleElement = document.querySelector('h2');
      var truncatedTitleElement = document.getElementById('truncatedTitle');

      if (titleElement) {
          var words = titleElement.innerText.split(' ');

          // Check if title contains more than 3 words
          if (words.length > 3) {
              var truncatedTitle = words.slice(0, 2).join(' ');
              truncatedTitleElement.innerText = truncatedTitle;
          } else {
              // If the title has 3 or fewer words, display the original title
              truncatedTitleElement.innerText = titleElement.innerText;
          }
      }
  });
</script>
<div class="stripdiv">
  <div class="container">
    <p class="me-lg-5">
      {{ service_desc }}
    </p>
    <!-- <div class="center-container">
      <a class="col" href="{% url 'main:display_service' slug=title|slugify %}">Start {{ title }} Now</a>
    </div> -->
  </div>
</div>
<div class="services-div">
  <div class="container-lg">
    <div class="row flex-column-reverse flex-md-row">
      <div class="col-md-6 pe-lg-5">
        <h2 class="mt-4 mt-md-0" style="text-align: left;"> About Coda</h2>
        <hr style="width: 36%; height: 4px; background-color: #E7AD4A;">
          <div class="text-content" id="readMoreContent">
              <p class="me-lg-5" id="truncatedText">
                {{ content|safe|truncatechars:404 }}
              </p>
              <p class="me-lg-5" id="remainingText" style="display: none;">
                {{ content|safe }}
            </p>
            <a onclick="toggleReadMore()" class="btn btn-primary" id="readMoreButton">
              Read more
            </a>
          </div>
      </div>
      <div class="col-md-6">
        <!-- <video class="img-fluid ps-lg-5" width="100%" height="auto" controls style="padding-top: 71px;">
          <source src="{% static 'main/image/vid_v1.mp4' %}" type="video/mp4">
          Your browser does not support the video tag.
        </video> -->
      <div class="videocontainers">
        <div class="videocontainer">
          <iframe src="https://drive.google.com/file/d/1HNif_Ru_0UqZbvFy792NSZqtTyc460Um/preview" width="100%" height="auto" controls crossorigin playsinline class="plyr"></iframe>
        </div>
      </div>
      </div>
    </div>
  </div> 
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
      const player = new Plyr('.plyr');
  });
</script>
<style>
   .videocontainers{
    padding-top: 97px;
  }
  .videocontainer {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    overflow: hidden;
  }

  .videocontainer iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 0;
  }
</style>
{% include 'main/services/course.html'%}
<!-- <div class="testimonials-div">
  <div class="container">
    <h1>SUCCESS STORIES</h1>
    <div class="owl-carousel">
      {% for investment in investments %}
        <div class="carousel-card {% if forloop.counter > 3 %}hidden{% endif %}">
          <h3> 
            <h3 style="margin-top: 20px;">
              {{ investment.client.first_name }}, {{ investment.client.last_name }}
            </h2>
          </h3>
          <p style="font-size: 18px;">Date: {{ investment.investment_date }}</p>
          <p style="font-size: 16px;">{{ investment.description }}</p>
        </div>
      {% endfor %}
    </div>
    <div class="owl-controls" style="margin-top: 20px;" >
      <button class="prev" onclick="moveCarousel(-1)"  style="color:var(--golden-color); font-size: 50px;">❮</button>
      <button class="next" onclick="moveCarousel(1)" style="color:var(--golden-color); font-size: 50px;">❯</button>
    </div>
  </div>
</div> -->
<div class="testimonials-div">
  <div class="container">
      <h1>CLIENT SUCCESS STORIES</h1>
      <div class="owl-carousel">
      <div class="row text-center commit"> 
        {% for post in posts %}
            <div class="{{ selected_class }}">
              <div class="carousel-card">
                <div class="img-div p-3">
                  <span>
                    <img onerror="handleImageErrorInsucessStory(this)" {%if post.writer.profile.img_url%} src="{{googledriveurl}}{{post.writer.profile.img_url}}" {%else%} src="{% static '/main/img/service-1.jpg' %}" {%endif%}class="team-img" width="115px" height="110px" style="border-radius: 50%;"/>
                  </span>
                </div>
                  <h3> 
                    <a href="{% url 'main:post-detail' post.id %}">
                      {{ post.writer.first_name }},{{post.writer.last_name}}
                    </a>
                  </h3>
                  <h3 style="font-size: 16px;">{{ post.title }} {{ count_to_class.post.count }}</h3>

                  <!-- <h3>{{post.title}} {{ count_to_class.post.count }}</h3> -->
                  <font size="2">
                      {{post.content|truncatewords:70}}
                    </font>
              </div>
            </div>
        {% endfor %}
        <!-- {% for post in posts %}
        <div class="col-md-4">
          <div class="carousel-card">
            <div class="img-div p-3">
              <span>
                <img src="{{googledriveurl}}={{post.writer.profile.image2.image_url}}" class="team-img" width="110px" height="110px" style="border-radius: 50%;"/>
              </span>
            </div>
              <h3> 
                <a href="{% url 'main:post-detail' post.id %}">
                  {{ post.writer.first_name }},{{post.writer.last_name}}
                </a>
              </h3>
              <h3>{{post.title}}</h3>
              <font size="2">
                  {{post.content|truncatewords:50}}
                </font>
          </div>
        </div>
        {% endfor %} -->
       </div>


      </div>
  </div>
</div>
 <div class="row text-center">

  <div class="col-md-6 back-to-top-btn d-flex justify-content-center">
    <a href="{% url 'main:post-create' %}">Share Your Experiences</a>
  </div>
  <div class="col-md-6 back-to-top-btn d-flex justify-content-center">
    <a href="">back to top</a>
  </div>
  </div> 

  <script>
    function handleImageError(img) {
     img.src = "{% static 'main/img/home/project2.jpg' %}"
    }
    function handleImageErrorInsucessStory(img) {

      img.src = "{% static '/main/img/service-1.jpg' %}"
    }
    function toggleContent(message_type, service_description, index) {
        
        var descriptionDiv = document.getElementById("description"+index)
        if (message_type == 'more-content') {
          var message = 'eleborate this content:' + service_description
          // console.log(message)
        }
        else{
          var message = 'short this content:' + service_description
          // console.log(message)
        }
        var url = "{% url 'main:get_respos' %}?userMessage="+message+"&generalUse=True"
        // var csrftoken = getCookie('csrftoken');  // Assuming you have a function to retrieve the CSRF token

        fetch(url, {
          method:'GET',
          headers:{
            'Content-type':'application/json',
            //'X-CSRFToken':csrftoken,
          },
        }).then(response => response.json())
          .then(data => {
              var newParagraph = document.createElement('p');

              // Set the content of the new paragraph
              newParagraph.textContent = data['response'];

             
              descriptionDiv.innerHTML = '';  // Remove existing content
              descriptionDiv.appendChild(newParagraph);

          })
          .catch(error => {
              console.error('Error:', error);
          });
    }
  </script>

 {% include 'main/snippets_templates/chat.html'%} 

  </div> 
{% endblock %}