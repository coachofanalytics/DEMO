  {%extends "main/base_templates/base.html"%} {% block content %}
  {% load static %}
  {% block title %}
  <!----{% if department %}{{ department.name }}{% else %}activities{% endif %}----->
  {% endblock %}
  <!--------------------------Slider Section--------------------------------->
  <!-------------------Our home services Section------------------------->
  <!-------------------1. Our  Job Report Section------------------------->
  
  <section id="data_training">
  <div class="data_training text-center">
    <!-- <h3 class="title">WELCOME BACK {{user.first_name|upper }}</h3> -->
    <div class="row text-center">
      <div class="col-md-2 amount_msg" id="bada">
          <div class="card">
            <div class="card-body">
              <h5><b>WELCOME BACK</b></h5>
              <hr/>
              <i><h6>{{user.first_name|upper }}</h6></i>
              <hr/>
              <i><p>Please Proceed!</p></i>
            </div>
          </div>
        </div>
        <div class="col-md-8" id="bada">
          <div class="card">
            <div class="card-body">
              <h5><b>TIME LEFT FOR MAXIMIZING YOUR PAY</b></h5>
              <hr/>
              <h5><b class="remaining-time"></b></h5>
              <hr/>
              <i><h6><b>{{pointsbalance}}</b> Points Left to be completed,kindly proceed!</b></i>
            </div>
          </div>
        </div>
        <div class="col-md-2" id="bada">
          <div class="card">
            <div class="card-body">
              <h5><b>PAY DAY</b></h5>
              <hr/>
              <i><h6>{{payday}}</h6></i>
              <hr/>
              <i><p>Assigned Amount</p></i>
            </div>
          </div>
        </div>
      </div>
    <h3 class="title">{{time_remaining}}</h3>
    <!-- <p class="p text-center">We Value Your Time Here at CODA, you have been assigned <b>{{num_tasks}}</b> activities with <b>{{time_remaining}}</b> days left this month</p> -->
  <input type="hidden" name="amounts" value="{{GoalAmount}} {{total_pay}}" id="total_amount">
  <div class="container-fluid mr-auto">
        <div class="row text-center">
                    <div class="col-md-2 amount_msg" id="bada">
                        <div class="card">
                          <div class="card-body">
                            <h5><b>Target</b></h5>
                            <hr/>
                            <!-- <i><h6>{{GoalAmount}}</h6></i> -->
                            <i><h6>{{average_earnings}}</h6></i>
                            <hr/>
                            <i><p>Past 3 Months data</p></i>
                          </div>
                        </div>
                      </div>
                      <!-- <div class="col-md-2" id="bada">
                        <div class="card">
                          <div class="card-body">
                            <h5><b>Total Target Amount</b></h5>
                            <hr/>
                            <i><h6>Ksh. {{GoalAmount}}</h6></i>
                            <hr/>
                            <i><p>Assigned Amount</p></i>
                          </div>
                        </div>
                      </div> -->
                      <div class="col-md-2" id="bada">
                        <div class="card">
                        <!-- <img src="\media\home\project2.jpg" class="card-img-top">--->
                          <div class="card-body">
                            <h5><b>Earned</b></h5>
                            <hr/>
                            <i><h6>Ksh.{{total_pay}}</h6></i>
                            
                            <hr/>
                            <i><p>Keep making progress</p></i>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2" id="bada">
                        <div class="card">
                        <!-- <img src="\media\home\project2.jpg" class="card-img-top">--->
                          <div class="card-body">
                            <h5><b>Pending</b></h5>
                            <hr/>
                            <i><h6>Ksh. {{paybalance}}</h6></i>
                            <hr/>
                            <i><p>Complete more tasks</p></i>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-2" id="bada">
                        <div class="card">
                        <!-- <img src="\media\home\project2.jpg" class="card-img-top">--->
                          <div class="card-body">
                            <h5><b>Points</b></h5>
                            <hr/>
                            <i><h6>{{Points}}/{{MaxPoints}}</h6></i>
                            <hr/>
                            <i><p>Balance:{{pointsbalance}}</p></i>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-2 point_msg" id="bada" data-toggle="tooltip">
                        <div class="card">
                        <!-- <img src="\media\home\project2.jpg" class="card-img-top">--->
                          <div class="card-body">
                            <h5><b>Net Income</b></h5>
                            <hr/>
                            <i><h6>Ksh.{{net}}</h6></i>
                            <hr/>
                            <i><p>Thank You!
                              <a href="{% url 'management:user_payslip' request.session.employee_name %}">More</a>
                            </p></i>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2" id="bada">
                        <div class="card">
                        <!-- <img src="\media\home\project2.jpg" class="card-img-top">--->
                          <div class="card-body">
                            <h5><b>Benefits</b></h5>
                            <hr/>
                            <i><h6>Benefits & tips on Increasing Your Pay</h6></i>
                            <hr/>
                            <i><a href="{% url 'management:hr'%}">More</a></i>
                          </div>
                        </div>
                      </div>
        </div>


        
      </div> 
  </div> 

  </section>
  <!----
  <section id="career">
    <div class="career text-center">
      <!----
      <div  class="row">
        <div class="col">
          <div class="card card-body">
            <form method="get">
              {% csrf_token %}
              {{myFilter.form}}
              <button class="btn btn-primary" type="submit">Search</button>
            </form>
          </div>
        </div>
      </div>
  ---->
      <table class="table table-borderless tasks" style="width: 100%">
        <thead class="border-bottom font-weight-bold">  
          <tr>
            <th>Check</th>
            <th>Task</th>
            <th>Deadline</th>
            <th>Submission</th>
            <th>Points</th>
            <th>Target Points</th>
            <th>Target Amount</th>
            <th>Earnings</th>
            <th>Evidence</th>
            <th>Update</th>
          </tr>
        </thead>
        <tbody>
          {% for task in  tasks  %}
              <tr>
                  <td><input type="checkbox" class="checkthis" /></td>
                  <td>
                      <a class="text-dark  text-decoration-none" 
                      data-toggle="tooltip" title="{{  task.description  }}"
                      href="{{ category.get_absolute_url }}">
                      {{  task.activity_name  }}
                      </a>
                  </td>
                  <!--  <td>{{task.employee}}</td>
                  <!--<td>{{task.group}}</td>-->
                  <td>{{task.deadline|date:"F d, Y"}}</td>
                  <td>{{task.submission|date:"F d, Y"}}</td>
                  <td>{{task.point}}</td>
                  <td>{{task.mxpoint}}</td>
                  <td>{{task.mxearning}}</td>
                  <td>{{task.get_pay}}</td>
                <td>
                  <button>
                    <a href="{{task.task_url}}">
                      Upload Evidence
                    </a>
                  </button>
                </td>
                
              <!-- <td> <a class="article-title" href="https://docs.google.com/spreadsheets/d/1Uiz7k6uP6ifoyiWp073rwliPw1CqVFVJUbKGyqJ-58s/edit?pli=1#gid=0">Excel Evidence</a></td> -->
              {%if user.is_admin or user.is_superuser%}
              <td> <a class="article-title" href="{% url 'management:userupdatetask' task.id %}">Edit</a></td>
              {%else%}
                <td> <a class="article-title" href="{{task.task_url}}">Evidence</a></td>
              {%endif%}
              </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
  <!-- <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="https://code.jquery.com/ui/1.11.2/jquery-ui.js"></script> -->
  <script type="text/javascript">
  $(document).ready(function() {
  var msg_data=[]
  $('.tasks tbody>tr').each(function () { 
  let task_data = ['sprint','general','recruitment','daf','meetings','bi support','job support','management']
  html_task_data = $(this). children("td:nth-child(2)").text().trim();
  html_points_data = $(this). children("td:nth-child(5)").text().trim();
  if (task_data.includes(html_task_data.toLowerCase()) && parseInt(html_points_data) === 0 &&(!msg_data.includes(html_task_data)))
  {
  msg_data.push(html_task_data)
  } 
  });
  if(msg_data.length != 0)
  {
  $(".point_msg").attr("title",`Your Pay will be delayed for this month kindly work on these activities ${msg_data.join(",").toString()}`)
  }


  var d = new Date();
  var day = d.getDate();
  let total_amount =$("#total_amount").val().split(" ");
  let condition1 = (total_amount[1]/total_amount[0])*100;
  let condition2 = day
  if(parseInt(condition1) < 33 && parseInt(day) < 15)
  {
  $(".amount_msg").attr("title",`Your Pay will be delayed for last month kindly work on these activities ${msg_data.join(",").toString()}`)
  }

  const calculateDateifference = setInterval(function(){
      let endate = "{{enddate}}"
      date_future = new Date(endate)
      date_future.setHours(23, 59, 59, 999);
      date_now = new Date()

      seconds = Math.floor((date_future - (date_now))/1000);
      minutes = Math.floor(seconds/60);
      hours = Math.floor(minutes/60);
      days = Math.floor(hours/24);
      
      hours = hours-(days*24);
      minutes = minutes-(days*24*60)-(hours*60);
      seconds = seconds-(days*24*60*60)-(hours*60*60)-(minutes*60);
      
      $(".remaining-time").text(`${days} Days ${hours} Hours ${minutes} Mins ${seconds} Secs`);

    },1000);

  });
  </script>
  {% endblock content %}
